---
title : "FIDO 프로토콜의 등록과 인증"
excerpt : "등록(Registration)과 증명(Attestation), 인증(Authentication)과 승인(Assertion)에 대해 알아봅니다"
author_profile: true
sidebar:
  nav: "sidebar"
toc: true
toc_sticky: true
category: DevBasic
---
   
클라이언트 사이드와 서버 사이드에서 FIDO 인증방식을 사용하기 위한 샘플코드들을 처음 봤을 때 느낀점은 **"이게 뭐야???"** 였습니다.

샘플 코드와 라이브러리 레퍼런스를 보다보면 나오는 **Attestation, relying party, MDS** 와 같은 단어들이 어느 목적인지 조차 이해하지 못했고  
  
조금 더 FIDO 라는 도메인에 대한 공부를 해야겠다는 결론을 내리게 되었습니다.   
  
---
  
이번 포스팅에서는 앞선 포스팅에서 얘기한, **FIDO 인증방식**의 **등록**과 **인증** 프로세스를 보다 자세히 다뤄보려 합니다.  
# **등록(Registration)**  
  
---  
  
최초에 사용자가 서비스 제공자의 서버에 인증 장치를 등록하는 단계입니다. 등록 단계에서는 두 종류의 키쌍이 등장합니다. 
  
  > ## **1. Credential key-pair**    
  > **인증 장치**가 생성해주는 키쌍으로, 공개키 암호화 방식을 통한 **인증** 프로세스를 수행하는데 사용됩니다.  
  >     
  > 등록 프로세스를 통해 **공개키(credential public key)**는 인증 서버에 등록되고, **개인키(credential private key)**는 인증장치의 안전한 공간에 저장됩니다. 
  >    
  > 이후 사용자는 서버에서 전달받은 임의의 값(Challenge)를 개인키를 이용해 전자서명하여 다시 서버에 전달 함으로써 자신을 증명하게 됩니다.     
  >
  > ## **2. Attestation key-pair**    
  > 인증장치를 생산할 때 제조사가 심어놓은 키쌍입니다.
  >   
  > 이 키쌍은 **private key** 그리고 **public key**를 포함하고 있는 **attestation certificate** 로 이루어져 있습니다.
  >
  > **증명**이란 등록 과정에서 서버에 전달되는 **credential public key**가 **FIDO 규격을 따르는 인증 장치로부터** 생성되었다는 것을 증명하는 과정입니다.  
  >
  > 인증 서버는 증명에 앞서 신뢰할 수 있는지를 검증하기 때문에, 인증 장치 제조사는 신뢰할 수 있는 공인된 CA 기관으로부터 **attestation certificate**를 발급 받아야 합니다.    
  >    
  > 즉 증명 과정은 **PKI 방식**을 이용합니다.
  >
  > 증명에 사용되는 이 키쌍은 제조사와 모델에 따라 달라지는 값입니다. 예를 들어 모든 **갤럭시 S22 핸드폰은 모두 동일한 증명 키쌍을 갖고있습니다.**  
  >  
  > 따라서 이 키쌍은 개별 인증장치를 구분해 사용자를 추적하는데 사용 될 수 없습니다. 
  
 

  1. FIDO 서버는 사용자의 인증장치에 챌린지라고 부르는 임의의 값을 전달합니다.   
  2. 인증장치(ex. 핸드폰)은 사용자를 검증하고(ex. 지문 인식을 통한 잠금해제), 키 쌍(공개키/개인키)과 Attestation(증명, 인증 장치에 대한 정보가 담긴 데이터)를 생성합니다.
  3. 인증장치는 공개키와 증명을 이용해 Assertion 생성하고 서명(암호화)하여, FIDO 서버로 전달합니다.  
  4. FIDO 서버는 서명을 검증하고, 검증에 성공 할 경우 인증장치로부터 전달받은 공개키를 사용자 계정에 매핑하여 저장합니다.   
  
# **인증(Authentication)**  
  
---  
  
  등록을 마친 사용자는 FIDO 서버에 등록된 공개키를 이용해 인증을 수행할 수 있습니다.    
  1. FIDO 서버는 인증을 요청한 인증장치(사용자)에게 챌린지와 몇 가지 추가적인 정보를 전달합니다. 
  2. 보안 장소에 보관된 개인키의 잠금을 해제하기 위해, 인증장치는 사용자 검증을 수행합니다.  
  3. 인증장치는 Assertion을 생성하고 서명하여 이를 FIDO 서버에 전달합니다. 
  4. FIDO 서버는 키 식별자를 기반으로 사용할 키를 식별하고, 해당 공개키를 찾아 서명을 검증합니다.  
  5. 검증에 성공할 경우 인증 프로세스는 종료되며, 인가(Authorization)를 위한 정보(JWT or Cookie)를 사용자에게 전달합니다.  
  

---
  
# Reference
### **[]()**  

  
&nbsp;  
&nbsp;  
  
잘못된 정보에 대한 피드백을 언제나 환영합니다. 많은 지적 바랍니다 :D 